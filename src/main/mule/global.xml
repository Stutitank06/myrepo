<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns:validation="http://www.mulesoft.org/schema/mule/validation"
	xsi:schemaLocation="
		http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
		http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
		http://www.mulesoft.org/schema/mule/validation http://www.mulesoft.org/schema/mule/validation/current/mule-validation.xsd">

	<!-- Configuration Properties -->
	<configuration-properties file="config/employees-local.yaml" doc:name="Configuration properties" doc:id="76baefc6-76a6-40fc-951b-1e71012a170e" />

	<!-- HTTP Listener Configuration -->
	<http:listener-config name="httpListenerConfig" doc:name="HTTP Listener config" doc:id="f1caa9df-54a9-4ebb-a5fb-ccf16f5c7fae">
		<http:listener-connection host="${http.listener.host}" port="${http.listener.port}" />
	</http:listener-config>

	<!-- Validation Configuration -->
	<validation:config name="validationConfig" doc:name="Validation Config" doc:id="91fe13ab-e95b-4108-b70c-fe180a708a69" />

	<!-- Global Error Handler -->
	<error-handler name="globalErrorHandler" doc:name="Global Error Handler" doc:id="c5828c62-f832-432d-9203-87e160fda61f">
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="806e7f13-e5a2-4519-81bc-13e937f0e5b1" type="VALIDATION:*">
			<set-payload value='#[{
				"error": "Bad Request",
				"message": "Invalid or missing employeeCount parameter. Must be a positive integer between 1 and " ++ p("api.employees.maxCount"),
				"timestamp": now() as String {format: "yyyy-MM-dd HH:mm:ss"}
			}]' doc:name="Set Error Payload" doc:id="d8cd462c-e97b-4daf-8995-a9cb8aec1c42" />
			<set-variable value="400" doc:name="Set Status Code" doc:id="27102062-29a1-4708-a020-d0eb353adcc7" variableName="httpStatus" />
		</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="668f6fb2-a949-4d8e-ad0b-1ae2f39031da" type="ANY">
			<set-payload value='#[{
				"error": "Internal Server Error",
				"message": "An unexpected error occurred while processing your request",
				"timestamp": now() as String {format: "yyyy-MM-dd HH:mm:ss"}
			}]' doc:name="Set Generic Error Payload" doc:id="56616069-0ae2-436c-b7dc-61215d7c9051" />
			<set-variable value="500" doc:name="Set Status Code" doc:id="d94df476-174b-4975-bce6-f609af933ede" variableName="httpStatus" />
		</on-error-propagate>
	</error-handler>

</mule>
